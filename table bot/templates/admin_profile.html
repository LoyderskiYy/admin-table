{% extends "base.html" %}

{% block title %}Профиль администратора - Admin Panel{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; text-align: left;">
    <h1>Профиль администратора: {{ target_user.username }}</h1>
    
    <div class="profile-grid">
        <div class="profile-card glass">
            <h3>Основная информация</h3>
            <p><strong>Дата постановления:</strong> {{ profile.date_appointed.strftime('%Y-%m-%d') if profile.date_appointed else '---' }}</p>
            <p><strong>Последнее повышение:</strong> {{ profile.last_promotion.strftime('%Y-%m-%d') if profile.last_promotion else '---' }}</p>
            <p><strong>Причина постановления:</strong> {{ profile.reason_appointed or '---' }}</p>
            <p><strong>Баллы:</strong> {{ profile.points }}</p>
            <p><strong>Должность:</strong> {{ profile.position or '---' }} (Уровень {{ target_user.admin_level }})</p>
            <p><strong>Префикс:</strong> {{ profile.prefix or '---' }}</p>
        </div>

        {% if session.get('admin_level', 0) >= 7 %}
        <div class="profile-card glass">
            <h3>Редактирование профиля</h3>
            <form action="{{ url_for('edit_profile', user_id=target_user.id) }}" method="POST">
                <div class="form-group">
                    <label>Дата постановления</label>
                    <input type="date" name="date_appointed" class="form-control" value="{{ profile.date_appointed.strftime('%Y-%m-%d') if profile.date_appointed }}">
                </div>
                <div class="form-group">
                    <label>Последнее повышение</label>
                    <input type="date" name="last_promotion" class="form-control" value="{{ profile.last_promotion.strftime('%Y-%m-%d') if profile.last_promotion }}">
                </div>
                <div class="form-group">
                    <label>Причина постановления</label>
                    <input type="text" name="reason_appointed" class="form-control" value="{{ profile.reason_appointed or '' }}">
                </div>
                <div class="form-group">
                    <label>Баллы</label>
                    <input type="number" name="points" class="form-control" value="{{ profile.points }}">
                </div>
                <div class="form-group">
                    <label>Должность</label>
                    <input type="text" name="position" class="form-control" value="{{ profile.position or '' }}">
                </div>
                <div class="form-group">
                    <label>Префикс</label>
                    <input type="text" name="prefix" class="form-control" value="{{ profile.prefix or '' }}">
                </div>
                <div class="form-group">
                    <label>Уровень должности (1-10)</label>
                    <input type="number" name="admin_level" class="form-control" value="{{ target_user.admin_level }}" min="1" max="10">
                </div>
                <button type="submit" class="login-button" style="width: 100%;">Сохранить изменения</button>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="profile-card glass mt-4">
        <h3>Лог изменений</h3>
        <div class="log-list">
            {% for entry in logs %}
            <div class="log-item">
                <span class="log-actor">{{ entry.actor.username }}</span>: 
                <span class="log-action">{{ entry.action }}</span>
                <span class="log-date">{{ entry.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
            {% else %}
            <p>Логов пока нет.</p>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .profile-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    @media (max-width: 768px) {
        .profile-grid {
            grid-template-columns: 1fr;
        }
    }
    .profile-card {
        padding: 20px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .mt-4 { margin-top: 2rem; }
    .log-item {
        padding: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        font-size: 0.9rem;
    }
    .log-actor { color: #6e8efb; font-weight: bold; }
    .log-date { float: right; color: #888; }
    .form-group { margin-bottom: 15px; }
    .form-control {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
        color: white;
        box-sizing: border-box;
    }
</style>
{% endblock %}
